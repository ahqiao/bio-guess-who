<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bio Guess Who â€“ Live Multiplayer</title>
<style>
body { font-family: "Segoe UI", Arial, sans-serif; background:#f0f0f0; padding:10px; display:flex; justify-content:center; }
.card { background:#fff; padding:20px; border-radius:12px; width:500px; margin:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
h1 { color:#5c6bc0; }
button { background:#9575cd; color:white; border:none; border-radius:10px; padding:8px 12px; margin:5px; cursor:pointer; }
button:hover { background:#7e57c2; }
input { width:95%; padding:8px; margin:5px 0; border-radius:8px; border:1px solid #cfd8dc; }
#deductionBoard { display:grid; grid-template-columns: repeat(2, 1fr); gap:5px; margin-top:10px; }
.tile { padding:6px; border:1px solid #cfd8dc; border-radius:6px; text-align:center; cursor:pointer; background:#fafafa; transition:0.3s; }
.tile.used { opacity:0.4; background:#ddd; pointer-events:none; }
#log { background:#f5f5f5; padding:10px; border-radius:6px; max-height:120px; overflow-y:auto; margin-top:10px; font-size:14px; }
</style>
</head>
<body>

<div class="card" id="setup">
  <h1>ðŸ§¬ Bio Guess Who â€“ Live</h1>
  <p>Enter secret terms and create/join a game</p>
  <input id="playerName" placeholder="Your Name">
  <input id="secretTerm" placeholder="Your secret term">
  <button onclick="createRoom()">Create Game</button>
  <input id="roomCode" placeholder="Room code to join">
  <button onclick="joinRoom()">Join Game</button>
</div>

<div class="card hidden" id="game">
  <h2 id="turnText"></h2>
  <p>Round: <span id="round">1</span>/5</p>
  <input id="questionInput" placeholder="Ask a YES/NO question">
  <button onclick="askQuestion()">Ask Question</button>
  <p>Answer the question:</p>
  <button onclick="answer('YES')">YES</button>
  <button onclick="answer('NO')">NO</button>
  <h3>Deduction Board</h3>
  <div id="deductionBoard"></div>
  <div id="log"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// ===== Firebase setup =====
const firebaseConfig = {
  apiKey: "AIzaSyAc3cG9ui8aN6aBOYU6Zg24t2RtX5l1uMo",
  authDomain: "guess-who-with-biology.firebaseapp.com",
  databaseURL: "https://guess-who-with-biology-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "guess-who-with-biology",
});
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Game variables =====
let room = null;
let player = null;
let secret = "";
let playerNumber = null;
let currentRound = 1;
let maxRounds = 5;

// ===== Deduction tiles =====
const tiles = [
  "Heart","Kidney","Liver","Lungs","Stomach","Intestine","Pancreas","Brain", // organs
  "Femur","Humerus","Skull","Rib","Vertebra","Clavicle","Tibia","Fibula", // bones
  "Amylase","Lipase","Pepsin","Trypsin","DNA Polymerase","Catalase","Lactase", // enzymes
  "Red Blood Cell","White Blood Cell","Neuron","Muscle Cell","Epithelial Cell","Sperm Cell","Egg Cell","Mitochondrion","Nucleus","Ribosome","Chloroplast" // cells
];

// ===== Setup functions =====
function createRoom(){
  player = document.getElementById("playerName").value.trim();
  secret = document.getElementById("secretTerm").value.trim();
  if(!player || !secret){ alert("Enter name and secret term!"); return; }
  room = Math.random().toString(36).substr(2,5).toUpperCase();
  playerNumber = 1;
  db.ref('rooms/'+room).set({
    p1Name: player,
    p1Secret: secret,
    p2Name: "",
    p2Secret: "",
    turn: 1,
    round: 1,
    question: "",
    answer: "",
    log: []
  });
  alert("Game created! Room code: "+room);
  document.getElementById("setup").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  loadDeductionBoard();
  listenRoom();
}

function joinRoom(){
  player = document.getElementById("playerName").value.trim();
  secret = document.getElementById("secretTerm").value.trim();
  room = document.getElementById("roomCode").value.trim().toUpperCase();
  if(!player || !secret || !room){ alert("Enter name, secret term, and room code!"); return; }
  db.ref('rooms/'+room).get().then(snapshot=>{
    if(!snapshot.exists()){ alert("Room not found"); return; }
    const data = snapshot.val();
    if(data.p2Name){ alert("Room full!"); return; }
    playerNumber = 2;
    db.ref('rooms/'+room+'/p2Name').set(player);
    db.ref('rooms/'+room+'/p2Secret').set(secret);
    document.getElementById("setup").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    loadDeductionBoard();
    listenRoom();
  });
}

// ===== Deduction board =====
function loadDeductionBoard(){
  const board = document.getElementById("deductionBoard");
  board.innerHTML = "";
  tiles.forEach(t=>{
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.textContent = t;
    tile.onclick = ()=>{
      tile.classList.toggle("used");
    };
    board.appendChild(tile);
  });
}

// ===== Real-time updates =====
function listenRoom(){
  db.ref('rooms/'+room).on('value', snapshot=>{
    const data = snapshot.val();
    if(!data) return;
    currentRound = data.round;
    document.getElementById("round").textContent = currentRound;
    let turnPlayer = data.turn===1?data.p1Name:data.p2Name;
    document.getElementById("turnText").textContent = "Turn: "+turnPlayer;
    if(data.question && data.answer){
      log(turnPlayer + " asked: " + data.question);
      log("Answer: " + data.answer);
    }
  });
}

// ===== Question/Answer =====
function askQuestion(){
  if(playerNumber !== currentRoundTurn()) { alert("Not your turn"); return; }
  const q = document.getElementById("questionInput").value.trim();
  if(!q) return;
  db.ref('rooms/'+room).update({ question: q, answer: "" });
  document.getElementById("questionInput").value="";
}

function answer(ans){
  if(playerNumber === currentRoundTurn()) { alert("Wait for opponent to ask"); return; }
  db.ref('rooms/'+room).update({ answer: ans });
  endTurn();
}

// ===== Turns =====
function currentRoundTurn(){ return (currentRound % 2 === 1)? 1 : 2; }

function endTurn(){
  currentRound++;
  if(currentRound>maxRounds){
    alert("Max rounds reached! Game over.");
    return;
  }
  db.ref('rooms/'+room+'/round').set(currentRound);
}

// ===== Log helper =====
function log(msg){
  const l = document.getElementById("log");
  l.innerHTML += "<p>"+msg+"</p>";
  l.scrollTop = l.scrollHeight;
}
</script>
</body>
</html>
